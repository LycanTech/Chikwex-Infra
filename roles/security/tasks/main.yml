# Security Role - Main Tasks
---
- name: Include OS-specific variables
  ansible.builtin.include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}.yml"
        - "{{ ansible_distribution | lower }}.yml"
        - "{{ ansible_os_family | lower }}.yml"
      paths:
        - vars
      skip: true
  tags:
    - security

- name: Configure SELinux
  ansible.builtin.include_tasks: selinux.yml
  when:
    - ansible_os_family == "RedHat"
    - security_selinux_enabled | default(true)
  tags:
    - security
    - selinux

- name: Configure firewall
  ansible.builtin.include_tasks: firewall.yml
  when: security_firewall_enabled | default(true)
  tags:
    - security
    - firewall

- name: Configure fail2ban
  ansible.builtin.include_tasks: fail2ban.yml
  when: security_fail2ban_enabled | default(true)
  tags:
    - security
    - fail2ban

- name: Configure auditd
  ansible.builtin.include_tasks: auditd.yml
  when: security_auditd_enabled | default(true)
  tags:
    - security
    - auditd

- name: Security hardening
  ansible.builtin.include_tasks: hardening.yml
  tags:
    - security
    - hardening

- name: Configure automatic security updates
  ansible.builtin.include_tasks: auto_updates.yml
  when: security_auto_updates_enabled | default(true)
  tags:
    - security
    - updates
